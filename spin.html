<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spin and Win ‚Ä¢ Swastik Mobile</title>

  <!-- Premium festive fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;800&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#ff6a00;
      --brand2:#ff9f1c;
      --ink:#0f172a;
    }
    /* Background */
    body{
      margin:0;
      font-family:Poppins,system-ui,Arial;
      color:#fff;
      min-height:100vh;
      background:
        radial-gradient(1200px 600px at 70% -10%,#ffffff22 0%,#00000000 60%),
        linear-gradient(135deg,var(--brand) 0%, var(--brand2) 100%);
      display:flex; flex-direction:column; align-items:center;
    }

    /* Header */
    .hero{
      margin-top:20px;
      text-align:center;
    }
    .hero .line1{
      font-family:"Baloo 2", cursive;
      font-size:40px;
      line-height:1;
      text-shadow:0 4px 20px rgba(0,0,0,.25);
      display:flex; gap:10px; align-items:center; justify-content:center;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      background:#fff; color:var(--brand);
      border-radius:999px; padding:6px 14px; font-weight:800; margin-top:8px;
      box-shadow:0 8px 26px rgba(0,0,0,.25);
    }

    /* Inputs */
    .form{
      margin:14px 0 6px;
      display:flex; flex-direction:column; align-items:center;
    }
    .form input{
      width:260px; padding:12px 14px; margin:7px 0;
      border-radius:12px; border:0; outline:none;
      text-align:center; font-size:15px; color:#111;
      background:#fff;
      box-shadow:0 6px 18px rgba(0,0,0,.18);
    }

    /* Wheel Zone */
    .stage{
      position:relative; width:360px; height:360px; margin-top:8px;
    }

    /* LED ring (bulbs) */
    .bulb{
      position:absolute; left:50%; top:50%;
      width:12px; height:12px; border-radius:50%;
      background:#ffd36a; box-shadow:0 0 0 rgba(255,230,160,0.0);
      transform-origin:-160px center; /* distance from center */
      transition:filter .2s, box-shadow .2s, transform .2s;
    }
    .spinning .bulb{
      animation:flicker 0.8s infinite;
    }
    @keyframes flicker{
      0%{ box-shadow:0 0 6px 2px rgba(255,241,170,.9); }
      50%{ box-shadow:0 0 16px 6px rgba(255,241,170,1); }
      100%{ box-shadow:0 0 6px 2px rgba(255,241,170,.9); }
    }

    canvas{
      width:100%; height:100%;
      background:#fff; border-radius:50%;
      box-shadow:0 16px 50px rgba(0,0,0,.35), inset 0 0 0 10px #fff5;
    }

    /* Pointer ‚Äì points DOWN towards wheel */
    .pointer{
      position:absolute; top:-34px; left:50%; transform:translateX(-50%);
      width:0; height:0;
      border-left:22px solid transparent;
      border-right:22px solid transparent;
      border-bottom:46px solid #fff; /* downwards */
      filter:drop-shadow(0 3px 6px rgba(0,0,0,.35));
    }

    /* Spin Button */
    #spin{
      margin:18px 0 26px;
      padding:14px 30px; border:0; border-radius:999px;
      background:#fff; color:var(--brand); font-weight:800; letter-spacing:.3px;
      cursor:pointer; box-shadow:0 10px 26px rgba(0,0,0,.25);
      position:relative; overflow:hidden;
    }
    #spin:disabled{ background:#dcdcdc; color:#777; cursor:not-allowed; box-shadow:none; }
    #spin::after{
      content:""; position:absolute; inset:0;
      background:linear-gradient(120deg,transparent 0%,rgba(255,255,255,.7) 50%,transparent 100%);
      transform:translateX(-150%); transition:transform .6s;
    }
    #spin:hover:enabled::after{ transform:translateX(150%); }

    /* Popup */
    .popup{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); align-items:center; justify-content:center; }
    .popup .box{
      background:#fff; color:#222; border-radius:18px; padding:26px; width:min(92%,420px);
      text-align:center; box-shadow:0 20px 60px rgba(0,0,0,.4); animation:pop .35s ease-out;
    }
    .popup h2{ margin:0 0 8px; color:var(--brand); font-weight:800; }
    .popup button{ margin-top:12px; padding:10px 18px; border:0; border-radius:10px; background:var(--brand); color:#fff; font-weight:700; cursor:pointer; }
    @keyframes pop{ from{ transform:scale(.7); opacity:0 } to{ transform:scale(1); opacity:1 } }

    /* Footer note */
    .foot{ opacity:.9; font-size:12px; margin-bottom:14px; }
  </style>
</head>
<body>
  <div class="hero">
    <div class="line1">ü™î Diwali Offer ‚Ä¢ <span style="font-weight:800">Spin and Win</span> üéÅ</div>
    <div class="badge">Swastik Mobile</div>
  </div>

  <div class="form">
    <input id="name" type="text" placeholder="Enter Name" />
    <input id="phone" type="text" placeholder="Enter Mobile Number" />
  </div>

  <div class="stage" id="stage">
    <!-- LED bulbs will be generated by JS -->
    <div class="pointer"></div>
    <canvas id="wheel" width="340" height="340"></canvas>
  </div>

  <button id="spin" disabled>SPIN NOW</button>
  <div class="foot">Good luck! ‚ú®</div>

  <!-- Result Popup -->
  <div class="popup" id="popup">
    <div class="box">
      <h2>üéâ Result</h2>
      <p id="prize"></p>
      <button onclick="closePopup()">OK</button>
    </div>
  </div>

  <!-- Firebase (ESM v12) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

    /* YOUR CONFIG (as given) */
    const firebaseConfig = {
      apiKey: "AIzaSyCSUBeeYgAw9BbtqTXn8SCAmpAwcdpje84",
      authDomain: "swastik-spinwheel.firebaseapp.com",
      databaseURL: "https://swastik-spinwheel-default-rtdb.firebaseio.com",
      projectId: "swastik-spinwheel",
      storageBucket: "swastik-spinwheel.firebasestorage.app",
      messagingSenderId: "823485177747",
      appId: "1:823485177747:web:89dd2b75c361ecacaf1266"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    /* UI refs */
    const wheel = document.getElementById("wheel");
    const ctx   = wheel.getContext("2d");
    const stage = document.getElementById("stage");
    const spinBtn = document.getElementById("spin");

    /* Generate LED bulbs around wheel */
    const BULBS = 28;                     // number of LEDs
    const RADIUS_OFFSET = 160;            // distance from center
    for(let i=0;i<BULBS;i++){
      const b = document.createElement("div");
      b.className = "bulb";
      const deg = (360 / BULBS) * i;
      b.style.transform = `rotate(${deg}deg) translateX(${RADIUS_OFFSET}px)`;
      stage.appendChild(b);
    }

    /* Game data */
    const prizes = ["‚ùå Sorry No Gift","üéÅ 2 Gift","üéÅ 3 Gift","üéÅ 4 Gift","üéÅ 5 Gift"];
    const colors = ["#ef4444","#facc15","#22c55e","#3b82f6","#a855f7"];
    let probabilities = [50,20,15,10,5];
    let startAngle = 0;
    const usedNumbers = new Set();

    /* Read live probabilities */
    onValue(ref(db, "probabilities"), snap=>{
      if(snap.exists()){
        probabilities = snap.val();
        console.log("Probabilities:", probabilities);
      }
    });

    /* Draw wheel function */
    function drawWheel(){
      const arc = Math.PI*2 / prizes.length;
      for(let i=0;i<prizes.length;i++){
        const angle = startAngle + i*arc;
        ctx.fillStyle = colors[i];
        ctx.beginPath();
        ctx.moveTo(170,170);
        ctx.arc(170,170,170, angle, angle+arc);
        ctx.closePath(); ctx.fill();

        // labels
        ctx.save();
        ctx.translate(170,170);
        ctx.rotate(angle + arc/2);
        ctx.fillStyle = "#fff";
        ctx.font = "bold 16px Poppins, Arial";
        ctx.textAlign = "left";
        ctx.fillText(prizes[i], 72, 6);
        ctx.restore();
      }
      // glossy inner hub
      ctx.beginPath();
      ctx.arc(170,170,32,0,Math.PI*2);
      ctx.fillStyle="#ffffff";
      ctx.fill();
      ctx.strokeStyle="#ffd8b3";
      ctx.lineWidth=6; ctx.stroke();
    }
    drawWheel();

    /* Enable button when filled */
    const nameIn = document.getElementById("name");
    const phoneIn= document.getElementById("phone");
    function checkForm(){
      spinBtn.disabled = !(nameIn.value.trim() && phoneIn.value.trim());
    }
    nameIn.addEventListener("input",checkForm);
    phoneIn.addEventListener("input",checkForm);

    /* Weighted pick */
    function pickIndex(){
      const total = probabilities.reduce((a,b)=>a+b,0);
      let r = Math.random()*total, c=0;
      for(let i=0;i<prizes.length;i++){ c+=probabilities[i]; if(r<c) return i; }
      return 0;
    }

    /* Spin */
    spinBtn.addEventListener("click", ()=>{
      const name  = nameIn.value.trim();
      const phone = phoneIn.value.trim();
      if(usedNumbers.has(phone)){ alert("‚ö†Ô∏è This number has already played!"); return; }
      usedNumbers.add(phone);

      const idx = pickIndex();
      const arc = (2*Math.PI)/prizes.length;
      const stopAt = (prizes.length - idx) * arc - arc/2; // aligns with pointer at 12 o'clock

      const baseTurns = 6;                     // full rotations
      const finalDeg  = baseTurns*360 + (stopAt*180/Math.PI);
      const dur = 3200;
      const start = performance.now();

      // turn on bulbs
      stage.classList.add("spinning");

      (function animate(now){
        const t = now - start;
        if(t < dur){
          const k = t/dur;
          // ease-out cubic
          const eased = 1 - Math.pow(1-k, 3);
          const angleDeg = finalDeg * eased;
          startAngle = angleDeg * Math.PI/180;
          ctx.clearRect(0,0,340,340);
          drawWheel();
          requestAnimationFrame(animate);
        } else {
          stage.classList.remove("spinning"); // lights steady
          showPopup(name, phone, prizes[idx]);
        }
      })(start);
    });

    /* Popup */
    function showPopup(name, phone, prize){
      document.getElementById("prize").textContent = `${name} (${phone}), you got: ${prize}`;
      document.getElementById("popup").style.display = "flex";
    }
    window.closePopup = () => document.getElementById("popup").style.display="none";
  </script>
</body>
</html>

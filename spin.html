<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spin and Win ‚Ä¢ Swastik Mobile</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background: linear-gradient(135deg,#ff6a00,#ff9f1c); color:#fff; text-align:center; }
    h1 { margin:20px 0; text-shadow:0 2px 8px rgba(0,0,0,.3); }
    input { padding:12px; margin:8px; border-radius:10px; border:none; width:240px; text-align:center; }
    .wheel-wrap { position:relative; width:340px; height:340px; margin:20px auto; }
    canvas { width:100%; height:100%; background:#fff; border-radius:50%; box-shadow:0 12px 40px rgba(0,0,0,.35); }
    .pointer { position:absolute; top:-22px; left:50%; transform:translateX(-50%); border-left:20px solid transparent; border-right:20px solid transparent; border-bottom:42px solid #fff; }
    #spin { margin-top:18px; padding:14px 28px; border:none; border-radius:999px; background:#fff; color:#ff6a00; font-weight:800; cursor:pointer; }
    #spin:disabled { background:#ddd; color:#777; cursor:not-allowed; }
    .popup { display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); align-items:center; justify-content:center; }
    .popup .box { background:#fff; color:#222; border-radius:16px; padding:24px; text-align:center; width:min(92%,420px); }
    .popup h2 { margin:0 0 8px; color:#ff6a00; }
    .popup button { margin-top:12px; padding:10px 18px; border:0; border-radius:10px; background:#ff6a00; color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <h1>üé° Spin and Win ‚Äì Swastik Mobile üéÅ</h1>

  <input type="text" id="name" placeholder="Enter Name" /><br />
  <input type="text" id="phone" placeholder="Enter Mobile Number" /><br />

  <div class="wheel-wrap">
    <div class="pointer"></div>
    <canvas id="wheel" width="320" height="320"></canvas>
  </div>

  <button id="spin" disabled>SPIN NOW</button>

  <div class="popup" id="popup">
    <div class="box">
      <h2>üéâ Result</h2>
      <p id="prize"></p>
      <button onclick="closePopup()">OK</button>
    </div>
  </div>

  <!-- Firebase Config -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCSUBeeYgAw9BbtqTXn8SCAmpAwcdpje84",
      authDomain: "swastik-spinwheel.firebaseapp.com",
      databaseURL: "https://swastik-spinwheel-default-rtdb.firebaseio.com",
      projectId: "swastik-spinwheel",
      storageBucket: "swastik-spinwheel.firebasestorage.app",
      messagingSenderId: "823485177747",
      appId: "1:823485177747:web:89dd2b75c361ecacaf1266"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const wheel = document.getElementById("wheel");
    const ctx = wheel.getContext("2d");
    const prizes = ["‚ùå Sorry No Gift","üéÅ 2 Gift","üéÅ 3 Gift","üéÅ 4 Gift","üéÅ 5 Gift"];
    const colors = ["#ef4444","#facc15","#22c55e","#3b82f6","#a855f7"];
    let probabilities=[50,20,15,10,5];
    let startAngle=0; let usedNumbers=[];

    // Firebase listener
    onValue(ref(db,"probabilities"), (snap)=>{
      if(snap.exists()){ probabilities=snap.val(); console.log("Updated probabilities:",probabilities); }
    });

    function drawWheel(){
      const arc=Math.PI*2/prizes.length;
      for(let i=0;i<prizes.length;i++){
        const angle=startAngle+i*arc;
        ctx.fillStyle=colors[i]; ctx.beginPath();
        ctx.moveTo(160,160); ctx.arc(160,160,160,angle,angle+arc); ctx.closePath(); ctx.fill();
        ctx.save(); ctx.translate(160,160); ctx.rotate(angle+arc/2);
        ctx.fillStyle="white"; ctx.font="bold 14px Arial"; ctx.fillText(prizes[i],60,10); ctx.restore();
      }
    } drawWheel();

    document.getElementById("phone").addEventListener("input",()=>{
      document.getElementById("spin").disabled=!(name.value.trim() && phone.value.trim());
    });

    function getWeightedPrize(){
      let total=probabilities.reduce((a,b)=>a+b,0);
      let rand=Math.random()*total, cumulative=0;
      for(let i=0;i<prizes.length;i++){ cumulative+=probabilities[i]; if(rand<cumulative) return i; }
      return 0;
    }

    document.getElementById("spin").addEventListener("click",()=>{
      const name=document.getElementById("name").value.trim();
      const phone=document.getElementById("phone").value.trim();
      if(usedNumbers.includes(phone)){ alert("‚ö†Ô∏è Already played!"); return;}
      usedNumbers.push(phone);

      const chosenIndex=getWeightedPrize();
      const arc=(2*Math.PI)/prizes.length;
      const chosenAngle=(prizes.length-chosenIndex)*arc-arc/2;
      const spinAngle=1800+(chosenAngle*180/Math.PI);
      const duration=3000,start=performance.now();

      function animate(now){
        const elapsed=now-start;
        if(elapsed<duration){
          const progress=elapsed/duration, angle=spinAngle*progress;
          startAngle=angle*Math.PI/180; ctx.clearRect(0,0,320,320); drawWheel();
          requestAnimationFrame(animate);
        } else { showPopup(name,phone,prizes[chosenIndex]); }
      }
      requestAnimationFrame(animate);
    });

    function showPopup(name,phone,prize){
      document.getElementById("prize").textContent=`${name} (${phone}), you got: ${prize}`;
      document.getElementById("popup").style.display="flex";
    }
    function closePopup(){ document.getElementById("popup").style.display="none"; }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spin and Win ‚Ä¢ Swastik Mobile</title>

  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Poppins:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root{ --brand:#ff6a00; --brand2:#ff9f1c; }
    body{
      margin:0; font-family:Poppins,system-ui,Arial; color:#fff;
      min-height:100vh; background:linear-gradient(135deg,var(--brand),var(--brand2));
      display:flex; flex-direction:column; align-items:center;
    }
    .hero{ margin:18px 0 6px; text-align:center }
    .hero .title{ font-family:"Baloo 2"; font-size:38px; text-shadow:0 4px 18px rgba(0,0,0,.25) }
    .badge{
      display:inline-block; margin-top:6px; padding:6px 14px; border-radius:999px;
      background:#fff; color:var(--brand); font-weight:800; box-shadow:0 8px 26px rgba(0,0,0,.25)
    }

    .stage{ position:relative; width:360px; height:360px; margin-top:8px; }
    canvas{
      width:100%; height:100%; background:#fff; border-radius:50%;
      box-shadow:0 16px 50px rgba(0,0,0,.35), inset 0 0 0 10px #ffffff55;
    }
    /* pointer (top, pointing down to wheel) */
    .pointer{
      position:absolute; top:-34px; left:50%; transform:translateX(-50%);
      width:0; height:0;
      border-left:22px solid transparent; border-right:22px solid transparent;
      border-bottom:46px solid #fff; filter:drop-shadow(0 3px 6px rgba(0,0,0,.35));
    }

    /* LED bulbs on rim */
    .bulb{
      position:absolute; left:50%; top:50%;
      width:10px; height:10px; margin:-5px 0 0 -5px; border-radius:50%;
      background:#ffd36a; box-shadow:0 0 8px 2px rgba(255,241,170,.9);
    }
    .spinning .bulb{ animation:flicker .8s infinite }
    @keyframes flicker{ 0%{box-shadow:0 0 6px 2px rgba(255,241,170,.8)}
      50%{box-shadow:0 0 16px 6px rgba(255,241,170,1)}
      100%{box-shadow:0 0 6px 2px rgba(255,241,170,.8)} }

    #spin{
      margin:18px 0 26px; padding:14px 30px; border:0; border-radius:999px;
      background:#fff; color:var(--brand); font-weight:800; letter-spacing:.3px;
      cursor:pointer; box-shadow:0 10px 26px rgba(0,0,0,.25); position:relative; overflow:hidden;
    }
    #spin::after{
      content:""; position:absolute; inset:0;
      background:linear-gradient(120deg,transparent 0%,rgba(255,255,255,.7) 50%,transparent 100%);
      transform:translateX(-150%); transition:transform .6s;
    }
    #spin:hover::after{ transform:translateX(150%) }

    .popup{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); align-items:center; justify-content:center }
    .popup .box{
      background:#fff; color:#222; border-radius:18px; padding:26px; width:min(92%,420px);
      text-align:center; box-shadow:0 20px 60px rgba(0,0,0,.4); animation:pop .35s ease-out;
    }
    .popup h2{ margin:0 0 8px; color:var(--brand); font-weight:800 }
    .popup button{ margin-top:12px; padding:10px 18px; border:0; border-radius:10px; background:var(--brand); color:#fff; font-weight:700; cursor:pointer }
    @keyframes pop{ from{ transform:scale(.7); opacity:0 } to{ transform:scale(1); opacity:1 } }
  </style>
</head>
<body>
  <div class="hero">
    <div class="title">ü™î Diwali Dhamaka ‚Ä¢ Spin & Win üéÅ</div>
    <div class="badge">Swastik Mobile</div>
  </div>

  <div class="stage" id="stage">
    <div class="pointer"></div>
    <canvas id="wheel" width="340" height="340"></canvas>
  </div>

  <button id="spin">SPIN NOW</button>

  <div class="popup" id="popup">
    <div class="box">
      <h2>üéâ Result</h2>
      <p id="prize"></p>
      <button onclick="closePopup()">OK</button>
    </div>
  </div>

  <!-- Firebase (ESM v12) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

    // Your config (as you shared)
    const firebaseConfig = {
      apiKey: "AIzaSyCSUBeeYgAw9BbtqTXn8SCAmpAwcdpje84",
      authDomain: "swastik-spinwheel.firebaseapp.com",
      databaseURL: "https://swastik-spinwheel-default-rtdb.firebaseio.com",
      projectId: "swastik-spinwheel",
      storageBucket: "swastik-spinwheel.firebasestorage.app",
      messagingSenderId: "823485177747",
      appId: "1:823485177747:web:89dd2b75c361ecacaf1266"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // UI refs
    const wheel = document.getElementById("wheel");
    const ctx   = wheel.getContext("2d");
    const stage = document.getElementById("stage");
    const spinBtn = document.getElementById("spin");

    // LEDs around rim
    const BULBS = 28, R = 170; // radius
    for(let i=0;i<BULBS;i++){
      const b = document.createElement("div");
      b.className="bulb";
      const a = (i/BULBS)*Math.PI*2;
      const x = 170 + (R-6)*Math.cos(a); // -6 to sit just outside arc
      const y = 170 + (R-6)*Math.sin(a);
      b.style.left = `calc(50% + ${(x-170)}px)`;
      b.style.top  = `calc(50% + ${(y-170)}px)`;
      stage.appendChild(b);
    }

    // Game data
    const prizes = ["‚ùå Sorry No Gift","üéÅ 2 Gift","üéÅ 3 Gift","üéÅ 4 Gift","üéÅ 5 Gift"];
    const colors = ["#ef4444","#facc15","#22c55e","#3b82f6","#a855f7"];
    let probabilities=[50,20,15,10,5];   // default; live update from Firebase
    let startAngle = 0;

    onValue(ref(db,"probabilities"), snap=>{
      if(snap.exists()) probabilities = snap.val();
    });

    function drawWheel(){
      const arc = Math.PI*2/prizes.length;
      for(let i=0;i<prizes.length;i++){
        const angle = startAngle + i*arc;
        ctx.fillStyle = colors[i];
        ctx.beginPath(); ctx.moveTo(170,170);
        ctx.arc(170,170,170, angle, angle+arc); ctx.closePath(); ctx.fill();

        ctx.save(); ctx.translate(170,170); ctx.rotate(angle+arc/2);
        ctx.fillStyle="#fff"; ctx.font="bold 16px Poppins, Arial"; ctx.textAlign="left";
        ctx.fillText(prizes[i], 72, 6); ctx.restore();
      }
      // center hub
      ctx.beginPath(); ctx.arc(170,170,32,0,Math.PI*2); ctx.fillStyle="#fff"; ctx.fill();
      ctx.strokeStyle="#ffd8b3"; ctx.lineWidth=6; ctx.stroke();
    }
    drawWheel();

    function pickIndex(){
      const total = probabilities.reduce((a,b)=>a+b,0);
      let r=Math.random()*total, c=0;
      for(let i=0;i<prizes.length;i++){ c+=probabilities[i]; if(r<c) return i; }
      return 0;
    }

    // Ultra-smooth rAF animation (syncs to display refresh; great on 120Hz)
    function spin(){
      const idx = pickIndex();
      const arc = (2*Math.PI)/prizes.length;
      // we want chosen slice center at 12 o'clock (i.e., -œÄ/2), while we draw from startAngle
      const targetAngle = (-Math.PI/2) - (idx*arc) - arc/2; // center of slice at top
      const currentTurns = 6; // full spins before stopping
      const final = startAngle + currentTurns*2*Math.PI + (targetAngle - (startAngle % (2*Math.PI)));

      const dur = 3200;                 // ms (enough time but still snappy)
      const t0 = performance.now();
      stage.classList.add("spinning");

      function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

      function frame(now){
        const t = Math.min(1, (now - t0)/dur);
        const eased = easeOutCubic(t);
        const angle = startAngle + (final - startAngle)*eased;
        ctx.clearRect(0,0,340,340);
        startAngle = angle;
        drawWheel();
        if(t < 1) requestAnimationFrame(frame);
        else{
          stage.classList.remove("spinning");
          const result = prizes[idx];
          document.getElementById("prize").textContent = result;
          document.getElementById("popup").style.display = "flex";
        }
      }
      requestAnimationFrame(frame);
    }

    spinBtn.addEventListener("click", spin);
    window.closePopup = () => (document.getElementById("popup").style.display="none");
  </script>
</body>
</html>
